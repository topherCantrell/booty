from hardware import Hardware
import weavers
import frame
import time

test_29x24 = """
1..........................12
.2.........................43
..3..........................
...4.........................
....5........................
.....6.......................
......7......................
.......1.....................
........2....................
.........3...................
..........4..................
...........5.................
............6................
.............7...............
..............1..............
56.............2.............
78..............3............
.................4...........
..................5.........1
...................6.......7.
....................7.....6..
.....................1...4...
56....................2.4....
71.....................3.....
"""

test_32x24 = """
1..............56.............12
.2.............87.............43
..3.............................
...4............................
....5...........................
.....6..........................
......7.........................
.......1........................
........2.......................
.........3......................
..........4.....................
...........5....................
............6...................
.............7..................
..............1.................
56.............2................
78..............3...............
.................4.............4
..................5...........3.
...................6.........2..
....................7.......1...
.....................1.....7....
56....................2.4.6.....
71.....................3.5......
"""

def to_data(s):
    """convert ascii-art image to byte pixel data

    The characters '|', '-', '+', and '\n' are ignored (removed).
    The '.' character translates to '0'.
    Digit charcaters translate to their value.
    Letters A-Z translate to values 10-36.    
    """
    s = s.replace('\n', '')
    s = s.replace('\r', '')
    s = s.replace('|', '')
    s = s.replace('-', '')
    s = s.replace('+', '')
    ret = bytearray(len(s))
    pos = 0
    while (pos < len(s)):
        c = s[pos]
        if c == '.':
            ret[pos] = 0
        elif '0' <= c <= '9':
            ret[pos] = ord(c)-48
        else:            
            ret[pos] = ord(c)-65+10
        pos += 1
    return ret

hard = Hardware(using_dev=True, simulate_chest=True)
f = frame.Frame(hard)

data = to_data(weavers.test_29x24)
f.show(data)

while True:
    print(">>>",hard.get_buttons())
    time.sleep(1)
